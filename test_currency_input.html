<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Currency Input Format</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #1c1c1e;
            color: #ebebf5;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto;
        }
        .input-group {
            margin-bottom: 30px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #ebebf5;
            font-size: 16px;
            box-sizing: border-box;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: rgba(0, 122, 255, 1);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }
        .result {
            margin-top: 8px;
            padding: 12px;
            background: rgba(52, 199, 89, 0.1);
            border-radius: 8px;
            font-size: 14px;
            font-family: monospace;
        }
        .test-cases {
            margin-top: 40px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }
        .test-case {
            margin-bottom: 12px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            font-size: 13px;
        }
        .test-case code {
            color: #34c759;
        }
    </style>
</head>
<body>
    <h1>Currency Input Format Test</h1>
    <p style="color: rgba(235, 235, 245, 0.6); font-size: 14px;">Format: Koma (,) untuk separator ribuan, Titik (.) untuk desimal</p>

    <div class="input-group">
        <label>Saldo Awal Bank (Display)</label>
        <input type="text" id="opening_balance_display" placeholder="0.00">
        <div class="result">
            Raw Value: <span id="opening_raw">0</span>
        </div>
    </div>

    <div class="input-group">
        <label>Saldo Akhir Bank (Display)</label>
        <input type="text" id="closing_balance_display" placeholder="0.00">
        <div class="result">
            Raw Value: <span id="closing_raw">0</span>
        </div>
    </div>

    <div class="test-cases">
        <h3 style="margin-top: 0;">Test Cases:</h3>
        <div class="test-case">
            Input: <code>1234567.89</code> → Output: <code>1,234,567.89</code>
        </div>
        <div class="test-case">
            Input: <code>42485447.23</code> → Output: <code>42,485,447.23</code>
        </div>
        <div class="test-case">
            Input: <code>1000</code> → Output: <code>1,000.00</code>
        </div>
        <div class="test-case">
            Input: <code>500.5</code> → Output: <code>500.50</code>
        </div>
        <div class="test-case">
            Input: <code>1234.567</code> → Output: <code>1,234.56</code> (max 2 decimals)
        </div>
    </div>

    <script>
        // Currency formatting functions
        function formatCurrency(value) {
            // Remove all non-digit and non-decimal characters
            let numStr = value.replace(/[^\d.]/g, '');
            
            // Handle multiple decimal points
            const parts = numStr.split('.');
            if (parts.length > 2) {
                numStr = parts[0] + '.' + parts.slice(1).join('');
            }
            
            // Limit to 2 decimal places
            if (parts.length === 2 && parts[1].length > 2) {
                numStr = parts[0] + '.' + parts[1].substring(0, 2);
            }
            
            // Parse to number
            const num = parseFloat(numStr);
            if (isNaN(num)) return '';
            
            // Format with thousand separators and 2 decimals
            return num.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function parseCurrency(formattedValue) {
            // Remove commas and parse to float
            return parseFloat(formattedValue.replace(/,/g, '')) || 0;
        }

        // Setup currency input fields
        function setupCurrencyInput(displayInputId, rawDisplayId) {
            const displayInput = document.getElementById(displayInputId);
            const rawDisplay = document.getElementById(rawDisplayId);
            
            displayInput.addEventListener('input', function(e) {
                let value = e.target.value;
                
                // Remove formatting for processing
                let rawValue = value.replace(/,/g, '');
                
                // Store cursor position
                let cursorPos = e.target.selectionStart;
                let commasBefore = (value.substring(0, cursorPos).match(/,/g) || []).length;
                
                // Format the value
                let formatted = formatCurrency(rawValue);
                e.target.value = formatted;
                
                // Update raw display
                rawDisplay.textContent = parseCurrency(formatted);
                
                // Restore cursor position (adjust for added/removed commas)
                let commasAfter = (formatted.substring(0, cursorPos).match(/,/g) || []).length;
                let newCursorPos = cursorPos + (commasAfter - commasBefore);
                e.target.setSelectionRange(newCursorPos, newCursorPos);
            });
            
            displayInput.addEventListener('blur', function(e) {
                if (e.target.value) {
                    e.target.value = formatCurrency(e.target.value);
                    rawDisplay.textContent = parseCurrency(e.target.value);
                }
            });
            
            // Handle paste
            displayInput.addEventListener('paste', function(e) {
                setTimeout(() => {
                    let formatted = formatCurrency(e.target.value);
                    e.target.value = formatted;
                    rawDisplay.textContent = parseCurrency(formatted);
                }, 10);
            });
        }

        // Initialize currency inputs
        setupCurrencyInput('opening_balance_display', 'opening_raw');
        setupCurrencyInput('closing_balance_display', 'closing_raw');

        console.log('Currency Input Test Ready!');
        console.log('Try typing: 1234567.89 or 42485447.23');
    </script>
</body>
</html>
